---
const { pathname } = Astro.url;

function isActive(linkPath: string): boolean {
  if (linkPath === "/case-study/") {
    return pathname.startsWith("/case-study/");
  }
  if (linkPath === "/team") {
    return pathname === "/team" || pathname === "/team/";
  }
  return pathname === linkPath;
}
---

<style>
  #header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    height: 70px;
    padding: 0 2rem;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    box-sizing: border-box;
  }

  .header-title {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    margin-left: 0;
  }

  .header-title img {
    height: 40px;
    width: auto;
  }

  .header-title h2 {
    margin: 0;
    font-size: 2rem;
    font-weight: 600;
    color: #4a5568;
  }

  /* Desktop Navigation */
  .header-links {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 2rem;
    margin-right: 0;
  }

  .header-link {
    font-size: 1rem;
    text-decoration: none;
    color: #6b7280;
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    padding: 0.5rem 0;
  }

  .header-link:hover {
    color: #374151;
  }

  .header-link.selected {
    background: linear-gradient(
      135deg,
      #e67e22 0%,
      #f39c12 30%,
      #f1c40f 70%,
      #f4d03f 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 600;
  }

  .social-icons {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-left: 0.75rem;
    margin-right: 1rem;
    padding-left: 0.75rem;
    position: relative;
  }

  .social-icons::before {
    content: '';
    position: absolute;
    left: -15px;
    top: 50%;
    transform: translateY(-50%);
    width: 2px;
    height: 24px;
    background: linear-gradient(
      180deg,
      #e67e22 0%,
      #f39c12 30%,
      #f1c40f 70%,
      #f4d03f 100%
    );
    border-radius: 1px;
  }

  .social-icon {
    height: 20px;
    width: 20px;
    opacity: 0.7;
    transition: all 0.2s ease;
    object-fit: contain;
  }

  .social-icon:hover {
    opacity: 1;
    transform: scale(1.05);
  }

  /* Mobile Menu Toggle */
  .mobile-menu-toggle {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 32px;
    height: 32px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    margin-right: 0.5rem;
    border-radius: 4px;
    position: relative;
    z-index: 101;
  }

  .hamburger-line {
    width: 20px;
    height: 2px;
    background-color: #4a5568;
    margin: 2px 0;
    transition: 0.3s;
    border-radius: 1px;
  }

  /* Mobile Menu Overlay */
  .mobile-menu-overlay {
    display: none;
    position: fixed;
    top: 70px;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 98;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .mobile-menu-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  /* Mobile Menu */
  .mobile-menu {
    display: none;
    position: fixed;
    top: 70px;
    right: -100%;
    width: 280px;
    height: calc(100vh - 70px);
    background: white;
    z-index: 99;
    padding: 2rem 1.5rem;
    box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
    transition: right 0.3s ease;
    overflow-y: auto;
  }

  .mobile-menu.active {
    right: 0;
  }

  .mobile-menu-links {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .mobile-menu-link {
    font-size: 1.1rem;
    text-decoration: none;
    color: #4a5568;
    font-weight: 500;
    padding: 0.75rem 0;
    border-bottom: 1px solid #e2e8f0;
    transition: color 0.2s ease;
  }

  .mobile-menu-link:hover {
    color: #2d3748;
  }

  .mobile-menu-link.selected {
    background: linear-gradient(
      135deg,
      #e67e22 0%,
      #f39c12 30%,
      #f1c40f 70%,
      #f4d03f 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 600;
  }

  .mobile-social-icons {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
  }

  .mobile-social-icon {
    height: 20px;
    width: 20px;
    opacity: 0.7;
    transition: all 0.2s ease;
    object-fit: contain;
  }

  .mobile-social-icon:hover {
    opacity: 1;
    transform: scale(1.1);
  }

  /* Hamburger Animation */
  .mobile-menu-toggle.active .hamburger-line:nth-child(1) {
    transform: rotate(-45deg) translate(-4px, 4px);
  }

  .mobile-menu-toggle.active .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  .mobile-menu-toggle.active .hamburger-line:nth-child(3) {
    transform: rotate(45deg) translate(-4px, -4px);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    #header {
      padding: 0 1rem;
    }

    .header-links {
      display: none !important;
    }

    .mobile-menu-toggle {
      display: flex !important;
    }

    .mobile-menu-overlay,
    .mobile-menu {
      display: block !important;
    }
  }

  /* Small screen title adjustments */
  @media (max-width: 480px) {
    #header {
      padding: 0 0.75rem;
    }

    .header-title h2 {
      font-size: 1.5rem;
    }

    .header-title img {
      height: 32px;
    }

    .mobile-menu-toggle {
      margin-right: 0.25rem;
    }
  }
</style>

<nav id="header">
  <a href="/" class="header-title">
    <img src="/assets/pendulum-logo.svg" alt="Pendulum Logo" />
    <h2>Pendulum</h2>
  </a>

  <!-- Desktop Navigation -->
  <div class="header-links">
    <a href="/" class={`header-link ${isActive("/") ? "selected" : ""}`}>Home</a>
    <a
      href="/case-study/"
      class={`header-link ${isActive("/case-study/") ? "selected" : ""}`}
      >Case Study</a
    >
    <a
      href="/team"
      class={`header-link ${isActive("/team") ? "selected" : ""}`}
    >
      Our Team
    </a>
    
    <div class="social-icons">
      <a
        href="https://www.linkedin.com/company/pendulum-baas"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/linkedin-logo.svg"
          alt="Pendulum LinkedIn"
          class="social-icon"
        />
      </a>
      <a
        href="https://www.github.com/Pendulum-BaaS"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/github-mark.svg"
          alt="Pendulum GitHub"
          class="social-icon"
        />
      </a>
    </div>
  </div>

  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" id="headerMobileMenuToggle">
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="headerMobileMenuOverlay"></div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="headerMobileMenu">
    <div class="mobile-menu-links">
      <a href="/" class={`mobile-menu-link ${isActive("/") ? "selected" : ""}`}>Home</a>
      <a
        href="/case-study/"
        class={`mobile-menu-link ${isActive("/case-study/") ? "selected" : ""}`}
        >Case Study</a
      >
      <a
        href="/team"
        class={`mobile-menu-link ${isActive("/team") ? "selected" : ""}`}
      >
        Our Team
      </a>
    </div>

    <div class="mobile-social-icons">
      <a
        href="https://www.linkedin.com/company/pendulum-baas"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/linkedin-logo.svg"
          alt="Pendulum LinkedIn"
          class="mobile-social-icon"
        />
      </a>
      <a
        href="https://www.github.com/Pendulum-BaaS"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/github-mark.svg"
          alt="Pendulum GitHub"
          class="mobile-social-icon"
        />
      </a>
    </div>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.getElementById('headerMobileMenuToggle');
    const mobileMenu = document.getElementById('headerMobileMenu');
    const mobileMenuOverlay = document.getElementById('headerMobileMenuOverlay');

    if (!mobileMenuToggle || !mobileMenu || !mobileMenuOverlay) {
      console.warn('Header mobile menu elements not found');
      return;
    }

    function toggleHeaderMobileMenu() {
      const isActive = mobileMenu.classList.contains('active');
      
      if (isActive) {
        // Close menu
        mobileMenuToggle.classList.remove('active');
        mobileMenu.classList.remove('active');
        mobileMenuOverlay.classList.remove('active');
        document.body.style.overflow = '';
      } else {
        // Open menu
        mobileMenuToggle.classList.add('active');
        mobileMenu.classList.add('active');
        mobileMenuOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    // Toggle menu when hamburger is clicked
    mobileMenuToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      toggleHeaderMobileMenu();
    });

    // Close menu when overlay is clicked
    mobileMenuOverlay.addEventListener('click', toggleHeaderMobileMenu);

    // Close menu when a link is clicked
    const mobileMenuLinks = document.querySelectorAll('#headerMobileMenu .mobile-menu-link');
    mobileMenuLinks.forEach(link => {
      link.addEventListener('click', toggleHeaderMobileMenu);
    });

    // Close menu on window resize if screen gets large
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768 && mobileMenu.classList.contains('active')) {
        toggleHeaderMobileMenu();
      }
    });
  });
</script>
