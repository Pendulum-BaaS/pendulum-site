---
const { pathname } = Astro.url;

function isActive(linkPath: string): boolean {
  if (linkPath === "/case-study/") {
    return pathname.startsWith("/case-study/");
  }
  if (linkPath === "/team") {
    return pathname === "/team" || pathname === "/team/";
  }
  return pathname === linkPath;
}
---

<style>
  #header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    height: 70px;
    padding: 0 2rem;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    box-sizing: border-box;
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  [data-theme="dark"] #header {
    background: rgba(26, 26, 46, 0.95);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  .header-title {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    margin-left: 0;
  }

  .header-title img {
    height: 40px;
    width: auto;
  }

  .header-title h2 {
    margin: 0;
    font-size: 2rem;
    font-weight: 600;
    color: #4a5568;
    transition: color 0.3s ease;
  }

  [data-theme="dark"] .header-title h2 {
    color: #e2e8f0;
  }

  /* Desktop Navigation */
  .header-links {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 2rem;
    margin-right: 0;
  }

  .header-link {
    font-size: 1rem;
    text-decoration: none;
    color: #6b7280;
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    padding: 0.5rem 0;
  }

  [data-theme="dark"] .header-link {
    color: #9ca3af;
  }

  .header-link:hover {
    color: #374151;
  }

  [data-theme="dark"] .header-link:hover {
    color: #f3f4f6;
  }

  .header-link.selected {
    background: linear-gradient(
      135deg,
      #e67e22 0%,
      #f39c12 30%,
      #f1c40f 70%,
      #f4d03f 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 600;
  }

  .social-icons {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-left: 0.75rem;
    margin-right: 1rem;
    padding-left: 0.75rem;
    position: relative;
  }

  .social-icons::before {
    content: '';
    position: absolute;
    left: -15px;
    top: 50%;
    transform: translateY(-50%);
    width: 2px;
    height: 24px;
    background: linear-gradient(
      180deg,
      #e67e22 0%,
      #f39c12 30%,
      #f1c40f 70%,
      #f4d03f 100%
    );
    border-radius: 1px;
  }

  .social-icon {
    height: 20px;
    width: 20px;
    opacity: 0.7;
    transition: all 0.2s ease;
    object-fit: contain;
  }

  .social-icon:hover {
    opacity: 1;
    transform: scale(1.05);
  }

  /* Theme Toggle Button */
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 8px;
    background: transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    margin-left: 0.5rem;
  }

  .theme-toggle:hover {
    background: rgba(107, 114, 128, 0.1);
    transform: scale(1.05);
  }

  [data-theme="dark"] .theme-toggle:hover {
    background: rgba(156, 163, 175, 0.1);
  }

  .theme-toggle-icon {
    width: 20px;
    height: 20px;
    transition: all 0.3s ease;
  }

  /* Sun icon (visible in light mode) */
  .sun-icon {
    opacity: 1;
    transform: rotate(0deg);
  }

  [data-theme="dark"] .sun-icon {
    opacity: 0;
    transform: rotate(90deg);
  }

  /* Moon icon (visible in dark mode) */
  .moon-icon {
    position: absolute;
    opacity: 0;
    transform: rotate(-90deg);
  }

  [data-theme="dark"] .moon-icon {
    opacity: 1;
    transform: rotate(0deg);
  }

  /* Mobile Menu Toggle */
  .mobile-menu-toggle {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 32px;
    height: 32px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    margin-right: 0.5rem;
    border-radius: 4px;
    position: relative;
    z-index: 101;
  }

  .hamburger-line {
    width: 20px;
    height: 2px;
    background-color: #4a5568;
    margin: 2px 0;
    transition: 0.3s;
    border-radius: 1px;
  }

  [data-theme="dark"] .hamburger-line {
    background-color: #e2e8f0;
  }

  /* Mobile Menu Overlay */
  .mobile-menu-overlay {
    display: none;
    position: fixed;
    top: 70px;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 98;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  [data-theme="dark"] .mobile-menu-overlay {
    background: rgba(0, 0, 0, 0.7);
  }

  .mobile-menu-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  /* Mobile Menu */
  .mobile-menu {
    display: none;
    position: fixed;
    top: 70px;
    right: -100%;
    width: 280px;
    height: calc(100vh - 70px);
    background: white;
    z-index: 99;
    padding: 2rem 1.5rem;
    box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
    transition: right 0.3s ease, background-color 0.3s ease;
    overflow-y: auto;
  }

  [data-theme="dark"] .mobile-menu {
    background: #1a1a2e;
    box-shadow: -4px 0 12px rgba(0, 0, 0, 0.3);
  }

  .mobile-menu.active {
    right: 0;
  }

  .mobile-menu-links {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .mobile-menu-link {
    font-size: 1.1rem;
    text-decoration: none;
    color: #4a5568;
    font-weight: 500;
    padding: 0.75rem 0;
    border-bottom: 1px solid #e2e8f0;
    transition: color 0.2s ease;
  }

  [data-theme="dark"] .mobile-menu-link {
    color: #e2e8f0;
    border-bottom-color: #374151;
  }

  .mobile-menu-link:hover {
    color: #2d3748;
  }

  [data-theme="dark"] .mobile-menu-link:hover {
    color: #f3f4f6;
  }

  .mobile-menu-link.selected {
    background: linear-gradient(
      135deg,
      #e67e22 0%,
      #f39c12 30%,
      #f1c40f 70%,
      #f4d03f 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 600;
  }

  .mobile-social-icons {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
  }

  [data-theme="dark"] .mobile-social-icons {
    border-top-color: #374151;
  }

  .mobile-social-icon {
    height: 20px;
    width: 20px;
    opacity: 0.7;
    transition: all 0.2s ease;
    object-fit: contain;
  }

  .mobile-social-icon:hover {
    opacity: 1;
    transform: scale(1.1);
  }

  /* Mobile theme toggle */
  .mobile-theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 8px;
    background: transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
  }

  .mobile-theme-toggle:hover {
    background: rgba(107, 114, 128, 0.1);
    transform: scale(1.05);
  }

  [data-theme="dark"] .mobile-theme-toggle:hover {
    background: rgba(156, 163, 175, 0.1);
  }

  /* Hamburger Animation */
  .mobile-menu-toggle.active .hamburger-line:nth-child(1) {
    transform: rotate(-45deg) translate(-4px, 4px);
  }

  .mobile-menu-toggle.active .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  .mobile-menu-toggle.active .hamburger-line:nth-child(3) {
    transform: rotate(45deg) translate(-4px, -4px);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    #header {
      padding: 0 1rem;
    }

    .header-links {
      display: none !important;
    }

    .mobile-menu-toggle {
      display: flex !important;
    }

    .mobile-menu-overlay,
    .mobile-menu {
      display: block !important;
    }
  }

  /* Small screen title adjustments */
  @media (max-width: 480px) {
    #header {
      padding: 0 0.75rem;
    }

    .header-title h2 {
      font-size: 1.5rem;
    }

    .header-title img {
      height: 32px;
    }

    .mobile-menu-toggle {
      margin-right: 0.25rem;
    }
  }
</style>

<nav id="header">
  <a href="/" class="header-title">
    <img src="/assets/pendulum-logo.svg" alt="Pendulum Logo" />
    <h2>Pendulum</h2>
  </a>

  <!-- Desktop Navigation -->
  <div class="header-links">
    <a href="/" class={`header-link ${isActive("/") ? "selected" : ""}`}>Home</a>
    <a
      href="/case-study/"
      class={`header-link ${isActive("/case-study/") ? "selected" : ""}`}
      >Case Study</a
    >
    <a
      href="/team"
      class={`header-link ${isActive("/team") ? "selected" : ""}`}
    >
      Our Team
    </a>
    
    <div class="social-icons">
      <a
        href="https://www.linkedin.com/company/pendulum-baas"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/linkedin-logo.svg"
          alt="Pendulum LinkedIn"
          class="social-icon"
        />
      </a>
      <a
        href="https://www.github.com/Pendulum-BaaS"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/github-mark.svg"
          alt="Pendulum GitHub"
          class="social-icon"
        />
      </a>
      
      <!-- Theme Toggle Button -->
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
        <svg class="theme-toggle-icon sun-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
        </svg>
        <svg class="theme-toggle-icon moon-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" id="headerMobileMenuToggle">
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="headerMobileMenuOverlay"></div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="headerMobileMenu">
    <div class="mobile-menu-links">
      <a href="/" class={`mobile-menu-link ${isActive("/") ? "selected" : ""}`}>Home</a>
      <a
        href="/case-study/"
        class={`mobile-menu-link ${isActive("/case-study/") ? "selected" : ""}`}
        >Case Study</a
      >
      <a
        href="/team"
        class={`mobile-menu-link ${isActive("/team") ? "selected" : ""}`}
      >
        Our Team
      </a>
    </div>

    <div class="mobile-social-icons">
      <a
        href="https://www.linkedin.com/company/pendulum-baas"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/linkedin-logo.svg"
          alt="Pendulum LinkedIn"
          class="mobile-social-icon"
        />
      </a>
      <a
        href="https://www.github.com/Pendulum-BaaS"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="/assets/github-mark.svg"
          alt="Pendulum GitHub"
          class="mobile-social-icon"
        />
      </a>
      
      <!-- Mobile Theme Toggle -->
      <button class="mobile-theme-toggle" id="mobileThemeToggle" aria-label="Toggle dark mode">
        <svg class="theme-toggle-icon sun-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
        </svg>
        <svg class="theme-toggle-icon moon-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
        </svg>
      </button>
    </div>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const mobileThemeToggle = document.getElementById('mobileThemeToggle');
    const htmlElement = document.documentElement;

    // Check for saved theme preference or default to 'light'
    const currentTheme = localStorage.getItem('theme') || 'light';
    htmlElement.setAttribute('data-theme', currentTheme);

    function toggleTheme() {
      const currentTheme = htmlElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      htmlElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    // Add event listeners to both desktop and mobile theme toggles
    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
    }
    if (mobileThemeToggle) {
      mobileThemeToggle.addEventListener('click', toggleTheme);
    }

    // Mobile menu functionality
    const mobileMenuToggle = document.getElementById('headerMobileMenuToggle');
    const mobileMenu = document.getElementById('headerMobileMenu');
    const mobileMenuOverlay = document.getElementById('headerMobileMenuOverlay');

    if (!mobileMenuToggle || !mobileMenu || !mobileMenuOverlay) {
      console.warn('Header mobile menu elements not found');
      return;
    }

    function toggleHeaderMobileMenu() {
      const isActive = mobileMenu.classList.contains('active');
      
      if (isActive) {
        // Close menu
        mobileMenuToggle.classList.remove('active');
        mobileMenu.classList.remove('active');
        mobileMenuOverlay.classList.remove('active');
        document.body.style.overflow = '';
      } else {
        // Open menu
        mobileMenuToggle.classList.add('active');
        mobileMenu.classList.add('active');
        mobileMenuOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    // Toggle menu when hamburger is clicked
    mobileMenuToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      toggleHeaderMobileMenu();
    });

    // Close menu when overlay is clicked
    mobileMenuOverlay.addEventListener('click', toggleHeaderMobileMenu);

    // Close menu when a link is clicked
    const mobileMenuLinks = document.querySelectorAll('#headerMobileMenu .mobile-menu-link');
    mobileMenuLinks.forEach(link => {
      link.addEventListener('click', toggleHeaderMobileMenu);
    });

    // Close menu on window resize if screen gets large
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768 && mobileMenu.classList.contains('active')) {
        toggleHeaderMobileMenu();
      }
    });
  });
</script>
